<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AWS VPC网络部署参考 | 油腻中年大叔</title>
    <meta name="description" content="你想要的这里都没有，你不想要的这里都有">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    
    <link rel="preload" href="/assets/css/0.styles.73a37632.css" as="style"><link rel="preload" href="/assets/js/app.a9b2ada6.js" as="script"><link rel="preload" href="/assets/js/15.6f142d3a.js" as="script"><link rel="prefetch" href="/assets/js/1.d2e2dc02.js"><link rel="prefetch" href="/assets/js/2.8e580b6b.js"><link rel="prefetch" href="/assets/js/3.5ad76f5f.js"><link rel="prefetch" href="/assets/js/4.aa3b70f1.js"><link rel="prefetch" href="/assets/js/5.1d59a08d.js"><link rel="prefetch" href="/assets/js/6.181e5aa5.js"><link rel="prefetch" href="/assets/js/7.683c736a.js"><link rel="prefetch" href="/assets/js/8.45bfda61.js"><link rel="prefetch" href="/assets/js/9.002044dd.js"><link rel="prefetch" href="/assets/js/10.8bc53d36.js"><link rel="prefetch" href="/assets/js/11.50813293.js"><link rel="prefetch" href="/assets/js/12.1721a008.js"><link rel="prefetch" href="/assets/js/13.c52eee2c.js"><link rel="prefetch" href="/assets/js/14.dc0301dd.js"><link rel="prefetch" href="/assets/js/16.f0082783.js"><link rel="prefetch" href="/assets/js/17.f9d30e9a.js"><link rel="prefetch" href="/assets/js/18.086adfe7.js"><link rel="prefetch" href="/assets/js/19.da1cbebb.js"><link rel="prefetch" href="/assets/js/20.9b7a236b.js"><link rel="prefetch" href="/assets/js/21.39c9040b.js"><link rel="prefetch" href="/assets/js/22.c32a9191.js"><link rel="prefetch" href="/assets/js/23.6b0e9793.js"><link rel="prefetch" href="/assets/js/24.02f4831b.js"><link rel="prefetch" href="/assets/js/25.2a6a341b.js"><link rel="prefetch" href="/assets/js/26.600d7807.js"><link rel="prefetch" href="/assets/js/27.7a78c585.js"><link rel="prefetch" href="/assets/js/28.2c10157a.js"><link rel="prefetch" href="/assets/js/29.a4aff2d0.js"><link rel="prefetch" href="/assets/js/30.11035490.js"><link rel="prefetch" href="/assets/js/31.8cdf44b2.js"><link rel="prefetch" href="/assets/js/32.e611c0e0.js"><link rel="prefetch" href="/assets/js/33.b7e515e8.js"><link rel="prefetch" href="/assets/js/34.45fa917d.js"><link rel="prefetch" href="/assets/js/35.8e12ba4f.js"><link rel="prefetch" href="/assets/js/36.8ec841ec.js"><link rel="prefetch" href="/assets/js/37.840185cb.js"><link rel="prefetch" href="/assets/js/38.2b9ae659.js"><link rel="prefetch" href="/assets/js/39.526df9c0.js"><link rel="prefetch" href="/assets/js/40.138f4816.js"><link rel="prefetch" href="/assets/js/41.384a9888.js"><link rel="prefetch" href="/assets/js/42.a84f5523.js"><link rel="prefetch" href="/assets/js/43.6582b032.js"><link rel="prefetch" href="/assets/js/44.b894595b.js"><link rel="prefetch" href="/assets/js/45.227ae924.js"><link rel="prefetch" href="/assets/js/46.822fbd93.js"><link rel="prefetch" href="/assets/js/47.114ff897.js"><link rel="prefetch" href="/assets/js/48.4531d71d.js"><link rel="prefetch" href="/assets/js/49.466c421b.js"><link rel="prefetch" href="/assets/js/50.adb74ec0.js"><link rel="prefetch" href="/assets/js/51.ee145da9.js"><link rel="prefetch" href="/assets/js/52.9e6555ec.js"><link rel="prefetch" href="/assets/js/53.d13fb677.js"><link rel="prefetch" href="/assets/js/54.13ab9568.js"><link rel="prefetch" href="/assets/js/55.6b8e6fca.js"><link rel="prefetch" href="/assets/js/56.def6d551.js"><link rel="prefetch" href="/assets/js/57.405f673f.js"><link rel="prefetch" href="/assets/js/58.05f57c05.js"><link rel="prefetch" href="/assets/js/59.95070160.js"><link rel="prefetch" href="/assets/js/60.68ea3b06.js"><link rel="prefetch" href="/assets/js/61.b1f5ecaf.js"><link rel="prefetch" href="/assets/js/62.443a3f36.js"><link rel="prefetch" href="/assets/js/63.dd39d8b8.js"><link rel="prefetch" href="/assets/js/64.445b255c.js"><link rel="prefetch" href="/assets/js/65.78f4be13.js"><link rel="prefetch" href="/assets/js/66.2c5508a1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.73a37632.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">油腻中年大叔</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/algorithms/" class="nav-link">算法</a></div><div class="nav-item"><a href="/dart/" class="nav-link">Dart</a></div><div class="nav-item"><a href="/spring/" class="nav-link">spring</a></div><div class="nav-item"><a href="/drools/" class="nav-link">规则和业务流程</a></div><div class="nav-item"><a href="/eip/" class="nav-link">EIP集成工具</a></div><div class="nav-item"><a href="/other/" class="nav-link router-link-active">杂项</a></div><div class="nav-item"><a href="/riding/" class="nav-link">骑行</a></div><div class="nav-item"><a href="/ev3/" class="nav-link">LEGO EV3 </a></div><div class="nav-item"><a href="/mb/" class="nav-link">Micro:bit </a></div><div class="nav-item"><a href="/math/" class="nav-link">小学数学 </a></div><div class="nav-item"><a href="/eng/" class="nav-link">小学英语 </a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/algorithms/" class="nav-link">算法</a></div><div class="nav-item"><a href="/dart/" class="nav-link">Dart</a></div><div class="nav-item"><a href="/spring/" class="nav-link">spring</a></div><div class="nav-item"><a href="/drools/" class="nav-link">规则和业务流程</a></div><div class="nav-item"><a href="/eip/" class="nav-link">EIP集成工具</a></div><div class="nav-item"><a href="/other/" class="nav-link router-link-active">杂项</a></div><div class="nav-item"><a href="/riding/" class="nav-link">骑行</a></div><div class="nav-item"><a href="/ev3/" class="nav-link">LEGO EV3 </a></div><div class="nav-item"><a href="/mb/" class="nav-link">Micro:bit </a></div><div class="nav-item"><a href="/math/" class="nav-link">小学数学 </a></div><div class="nav-item"><a href="/eng/" class="nav-link">小学英语 </a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/other/redissearch.html" class="sidebar-link">Redis search with Lua</a></li><li><a href="/other/aws-deploy.html" class="active sidebar-link">AWS VPC网络部署参考</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/other/aws-deploy.html#_1-vpc定义" class="sidebar-link">1. VPC定义</a></li><li class="sidebar-sub-header"><a href="/other/aws-deploy.html#_2-vpc子网" class="sidebar-link">2.VPC子网</a></li><li class="sidebar-sub-header"><a href="/other/aws-deploy.html#_3-路由表" class="sidebar-link">3.路由表</a></li><li class="sidebar-sub-header"><a href="/other/aws-deploy.html#_4-vpc-internet网关" class="sidebar-link">4.VPC internet网关</a></li><li class="sidebar-sub-header"><a href="/other/aws-deploy.html#_5-弹性ip" class="sidebar-link">5. 弹性IP</a></li><li class="sidebar-sub-header"><a href="/other/aws-deploy.html#_6-nat" class="sidebar-link">6. NAT</a></li><li class="sidebar-sub-header"><a href="/other/aws-deploy.html#_7-ec2" class="sidebar-link">7. EC2</a></li><li class="sidebar-sub-header"><a href="/other/aws-deploy.html#_8-openvpn-as" class="sidebar-link">8. openvpn-AS</a></li><li class="sidebar-sub-header"><a href="/other/aws-deploy.html#_8-负载均衡" class="sidebar-link">8. 负载均衡</a></li><li class="sidebar-sub-header"><a href="/other/aws-deploy.html#_9-实验网络图" class="sidebar-link">9.实验网络图</a></li><li class="sidebar-sub-header"><a href="/other/aws-deploy.html#_10-附件" class="sidebar-link">10. 附件</a></li></ul></li><li><a href="/other/singletonAndMultiton.html" class="sidebar-link">Design Pattern Series: Singleton and Multiton Pattern</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="aws-vpc网络部署参考"><a href="#aws-vpc网络部署参考" aria-hidden="true" class="header-anchor">#</a> AWS VPC网络部署参考</h1> <h2 id="_1-vpc定义"><a href="#_1-vpc定义" aria-hidden="true" class="header-anchor">#</a> 1. VPC定义</h2> <p>Virtual Private Cloud (VPC) 是仅适用于 AWS 账户的虚拟网络。 它在逻辑上与 AWS 云中的其他虚拟网络隔绝。可在 VPC 中启动 AWS 资源，如 Amazon EC2 实例。</p> <p>可使用VPC向导，创建：</p> <ul><li>具有一个 /24 子网的 /16 网络。公有子网实例使用弹性 IP 或公有 IP 访问 Internet。</li> <li>具有两个 /24 子网的 /16 网络。公共子网实例，使用弹性 IP 地址访问 Internet。私有子网实例通过 Network Address Translation (NAT) 实例访问 Internet。 (NAT 实例按小时收费)</li></ul> <blockquote><p>VPC用户指南：http://docs.amazonaws.cn/AmazonVPC/latest/UserGuide/VPC_Subnets.html</p></blockquote> <p>下图为实验中创建的VPC：</p> <p><img src="/uploads/c3bd0df3971ebac7725661a2370405cd/image.png" alt="image"></p> <h2 id="_2-vpc子网"><a href="#_2-vpc子网" aria-hidden="true" class="header-anchor">#</a> 2.VPC子网</h2> <p>VPC 跨越区域中的所有可用区。在创建 VPC 之后，您可以在每个可用区域中添加一个或多个子网。 在创建子网时，指定子网的 CIDR 块，它是 VPC CIDR 块的子集。每个子网都必须完全位于一个可用区域之内，不能跨越多个可用区域。可用区域是被设计为可以隔离其他可用区域的故障的不同位置。通过启动独立可用区内的实例，您可以保护您的应用程序不受单一位置故障的影响。我们为每个子网指定一个唯一 ID。</p> <p><strong>如果子网的关联路由表包含指向 Internet 网关的路由，则该子网称为公有子网。</strong></p> <p>下图展示了一个在多个可用区域内配置子网的 VPC。1A、1B、2A 和 3A 是 VPC 中的实例。此 VPC 以及子网 1 各自关联了一个 IPv6 CIDR 块。Internet 网关允许在 Internet 上通信，虚拟专用网络 (VPN) 连接可实现与您公司网络的通信。
<img src="/uploads/6c62ae76be2560f662c343d98ebe32cd/image.png" alt="image"></p> <p>下图为实验中创建的子网：</p> <p><img src="/uploads/bb14a7fca6706262ba5259f2cbec1a61/image.png" alt="image"></p> <h2 id="_3-路由表"><a href="#_3-路由表" aria-hidden="true" class="header-anchor">#</a> 3.路由表</h2> <p>VPC 中的每个子网必须与一个路由表关联；路由表控制子网的路由。一个子网一次只能与一个路由表关联，但您可以将多个子网与同一路由表关联。AWS控制台中可以变更子网的路由表关联。</p> <p><img src="/uploads/c55073161e9182ea061cdf5ef39ab8be/image.png" alt="image"></p> <p>子网中的EC2实例访问外网有两种方式</p> <ul><li>采用NAT：建立NAT网关，并且为子网指定路由， 0.0.0.0/0。对于 Target，选择 NAT 网关的 ID。</li> <li>采用internet网关：参见下节说明</li></ul> <h2 id="_4-vpc-internet网关"><a href="#_4-vpc-internet网关" aria-hidden="true" class="header-anchor">#</a> 4.VPC internet网关</h2> <p>Internet 网关是一种横向扩展、支持冗余且高度可用的 VPC 组件，可实现 VPC 中的实例与 Internet 之间的通信。因此它不会对网络流量造成可用性风险或带宽限制。</p> <p>Internet 网关有两个用途，一个是在 VPC 路由表中为 Internet 可路由流量提供目标，另一个是为已经分配了公有 IPv4 地址的实例执行网络地址转换 (NAT)。</p> <blockquote><p>要为 VPC 子网中的实例启用 Internet 访问，必须执行以下操作：</p></blockquote> <blockquote><ul><li>将 Internet 网关附加到 VPC。</li></ul></blockquote> <blockquote><ul><li>确保子网的路由表指向 Internet 网关。</li></ul></blockquote> <blockquote><ul><li>确保您的子网中的实例具有全局唯一 IP 地址 (公有 IPv4 地址、弹性 IP 地址或 IPv6 地址)。</li></ul></blockquote> <blockquote><ul><li>确保您的网络访问控制和安全组规则允许相关流量在您的实例中流入和流出。</li></ul></blockquote> <p>下图为实验中创建的internet网关：</p> <p><img src="/uploads/94fb1ea37e7d3fa376664e079413c989/image.png" alt="image"></p> <p>internet网关需要附加在VPC网络上。</p> <h2 id="_5-弹性ip"><a href="#_5-弹性ip" aria-hidden="true" class="header-anchor">#</a> 5. 弹性IP</h2> <p>弹性 IP 地址 是专门用于进行动态云计算的静态、公有 IPv4 地址。您可以将弹性 IP 地址与您账户中的任意 VPC 的任何实例或网络接口相关联。借助弹性 IP 地址，您可以迅速将地址重新映射到 VPC 中的另一个实例，从而屏蔽实例故障。注意，将弹性 IP 地址与网络接口关联，而不直接与实例关联的优势在于，只需一步，即可将网络接口的所有属性从一个实例移至另一个。</p> <p><strong>与阿里云弹性IP概念类似。</strong></p> <h2 id="_6-nat"><a href="#_6-nat" aria-hidden="true" class="header-anchor">#</a> 6. NAT</h2> <p>NAT 设备支持私有子网中的实例连接到 Internet (例如，以便进行软件更新) 或其他 AWS 服务，但阻止 Internet 发起与实例的连接。NAT 设备将来自私有子网中实例的流量转发到 Internet 或其他 AWS 服务，然后将响应发回给实例。当流量流向 Internet 时，源 IPv4 地址替换为 NAT 设备的地址，同样，当响应流量流向这些实例时，NAT 设备将地址转换为这些实例的私有 IPv4 地址。</p> <p>AWS 提供了两种 NAT 设备：一种是 NAT 网关，一种是 NAT 实例。</p> <p>NAT网关需要配置到具备internet网关的子网.</p> <p><strong><a href="http://docs.amazonaws.cn/AmazonVPC/latest/UserGuide/vpc-nat-comparison.html" target="_blank" rel="noopener noreferrer">NAT 实例与 NAT 网关的比较<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong></p> <p>下图为实验中创建的NAT网关：</p> <p><img src="/uploads/3534e0062c5ffafcfed4d0b340baf5a4/image.png" alt="image"></p> <h2 id="_7-ec2"><a href="#_7-ec2" aria-hidden="true" class="header-anchor">#</a> 7. EC2</h2> <p>实验中创建的EC2实例，每个子网一个实例。1a可用区有2个实例，其中一个实例为VPN用途
<img src="/uploads/290193515f54f674e8a7eba82398f9d0/image.png" alt="image"></p> <h2 id="_8-openvpn-as"><a href="#_8-openvpn-as" aria-hidden="true" class="header-anchor">#</a> 8. openvpn-AS</h2> <p>使用ubuntu16.04安装openvpn-as（没有license的情况下只能有2个设备连接）
安装openvpn后，可以在客户端使用openvpn client拨入VPC网络</p> <p><img src="/uploads/0c5698dfd756978a891aa0128ff3d154/image.png" alt="image"></p> <p>** 建议使用udp:1194端口（默认）</p> <h2 id="_8-负载均衡"><a href="#_8-负载均衡" aria-hidden="true" class="header-anchor">#</a> 8. 负载均衡</h2> <p>有3种负载均衡</p> <p>如果没有长连接，应用采用http或者https推荐使用应用程序负载均衡器,这个是7层负载均衡，可以根据url转发请求。</p> <p>如果需要超高性能和静态 IP 地址，选择网络负载均衡器。</p> <p>内网应用采用传统均衡器</p> <p><strong><a href="https://amazonaws-china.com/cn/elasticloadbalancing/details/#compare" target="_blank" rel="noopener noreferrer">负载均衡比较<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong></p> <h2 id="_9-实验网络图"><a href="#_9-实验网络图" aria-hidden="true" class="header-anchor">#</a> 9.实验网络图</h2> <p><img src="/uploads/683e565367e0382291318978d40031b8/%E7%BD%91%E7%BB%9C%E5%9B%BE.png" alt="网络图"></p> <h2 id="_10-附件"><a href="#_10-附件" aria-hidden="true" class="header-anchor">#</a> 10. 附件</h2> <p><a href="/uploads/3d9f9ca235f060ed2adf5c6fefa7bd2a/%E4%BA%9A%E9%A9%AC%E9%80%8AAWS-VPC%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E8%8B%8F%E6%8C%AF%E7%A5%8E.pdf">亚马逊AWS-VPC最佳实践-苏振祎.pdf</a></p> <p><a href="/uploads/986eb5f5dcfe18fd5f380390372c98a5/%E4%BA%9A%E9%A9%AC%E9%80%8AAWS-%E5%88%A9%E7%94%A8AWS%E6%90%AD%E5%BB%BA%E6%B7%B7%E5%90%88%E4%BA%91%E7%9A%84%E6%9E%B6%E6%9E%84.pdf">亚马逊AWS-利用AWS搭建混合云的架构.pdf</a></p> <p><a href="/uploads/d32b072c8937a91789a8573af5b12def/%E4%BA%9A%E9%A9%AC%E9%80%8A-%E5%88%A9%E7%94%A8AWS-VPC%E5%92%8CIAM%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA%E9%AB%98%E5%BA%A6%E5%AE%89%E5%85%A8%E7%9A%84%E4%BA%91%E7%8E%AF%E5%A2%83.pdf">亚马逊-利用AWS-VPC和IAM服务搭建高度安全的云环境.pdf</a></p> <p><a href="/uploads/b68a0135b654713c2e9dab8a8a041e79/Powerpoint_18.02.22.zip">Powerpoint图标</a></p> <p><a href="/uploads/9400b63d4713a9065ae4af8676186552/Visio_18.02.22.zip">Visio图标</a></p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/other/redissearch.html" class="prev">
          Redis search with Lua
        </a></span> <span class="next"><a href="/other/singletonAndMultiton.html">
          Design Pattern Series: Singleton and Multiton Pattern
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/15.6f142d3a.js" defer></script><script src="/assets/js/app.a9b2ada6.js" defer></script>
  </body>
</html>
