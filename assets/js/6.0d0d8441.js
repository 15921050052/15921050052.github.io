(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{365:function(s,t,n){"use strict";n.r(t);var a=n(0),e=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"content"},[n("h2",{attrs:{id:"controller-是否线程安全"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#controller-是否线程安全","aria-hidden":"true"}},[s._v("#")]),s._v(" Controller 是否线程安全")]),s._v(" "),n("h3",{attrs:{id:"案例1-contoller对象属性操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例1-contoller对象属性操作","aria-hidden":"true"}},[s._v("#")]),s._v(" 案例1- Contoller对象属性操作")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Controller")]),s._v("\n"),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"/unsafe"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("UnsafeController")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("final")]),s._v(" Logger logger "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" LoggerFactory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getLogger")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UnsafeController"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" count "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"/index"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" String "),n("span",{attrs:{class:"token function"}},[s._v("index")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        count"),n("span",{attrs:{class:"token operator"}},[s._v("++")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Unsafe Controller count should be:"')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" count"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"unsafe"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("2021-01-02 07:33:03.749  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-3"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:2\n2021-01-02 07:33:03.749  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-7"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:3\n2021-01-02 07:33:03.750  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-2"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:5\n2021-01-02 07:33:03.750  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-8"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:6\n2021-01-02 07:33:03.751  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("io-8080-exec-10"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:7\n2021-01-02 07:33:03.751  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-9"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:8\n2021-01-02 07:33:03.750  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-6"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:4\n2021-01-02 07:33:03.752  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-4"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:9\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n2021-01-02 07:33:03.867  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-7"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:92\n2021-01-02 07:33:03.867  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-9"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:92\n2021-01-02 07:33:03.867  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-6"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:94\n2021-01-02 07:33:03.867  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-2"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:92\n2021-01-02 07:33:03.868  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-1"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:95\n2021-01-02 07:33:03.869  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("io-8080-exec-10"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:96\n2021-01-02 07:33:03.870  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-3"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:97\n2021-01-02 07:33:03.873  INFO 3183 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-7"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:98\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h3",{attrs:{id:"案例2-contoller对象属性加volatile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例2-contoller对象属性加volatile","aria-hidden":"true"}},[s._v("#")]),s._v(" 案例2-Contoller对象属性加volatile")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Controller")]),s._v("\n"),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"/unsafe"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("UnsafeController")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("final")]),s._v(" Logger logger "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" LoggerFactory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getLogger")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UnsafeController"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" count "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"/index"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" String "),n("span",{attrs:{class:"token function"}},[s._v("index")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        count"),n("span",{attrs:{class:"token operator"}},[s._v("++")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Unsafe Controller count should be:"')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" count"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"unsafe"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ab -n 100 -c 10 http://localhost:8080/unsafe/index\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("2021-01-02 10:57:15.117  INFO 5680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("io-8080-exec-10"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:86\n2021-01-02 10:57:15.119  INFO 5680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-6"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:89\n2021-01-02 10:57:15.119  INFO 5680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-5"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:90\n2021-01-02 10:57:15.119  INFO 5680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-9"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:88\n2021-01-02 10:57:15.119  INFO 5680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-3"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:91\n2021-01-02 10:57:15.119  INFO 5680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-7"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:92\n2021-01-02 10:57:15.119  INFO 5680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-4"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:93\n2021-01-02 10:57:15.119  INFO 5680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-1"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:94\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("volatile关键字能保证可见性,可见性只能保证每次读取的是最新的值，但是volatile没办法保证对变量的操作的原子性。所以最终输出并不是100.")]),s._v(" "),n("h3",{attrs:{id:"案例3-contoller对象属性-volatile-integer"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例3-contoller对象属性-volatile-integer","aria-hidden":"true"}},[s._v("#")]),s._v(" 案例3-Contoller对象属性: volatile + integer")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Controller")]),s._v("\n"),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"/unsafe"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("UnsafeController")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("final")]),s._v(" Logger logger "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" LoggerFactory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getLogger")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UnsafeController"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v("  "),n("span",{attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" Integer count "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"/index"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v("  String "),n("span",{attrs:{class:"token function"}},[s._v("index")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        count"),n("span",{attrs:{class:"token operator"}},[s._v("++")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Unsafe Controller count should be:"')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" count"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"unsafe"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ab -n 100 -c 10 http://localhost:8080/unsafe/index\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("2021-01-02 10:58:34.622  INFO 5711 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-6"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:89\n2021-01-02 10:58:34.623  INFO 5711 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-2"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:90\n2021-01-02 10:58:34.624  INFO 5711 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("io-8080-exec-10"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:91\n2021-01-02 10:58:34.624  INFO 5711 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-9"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:92\n2021-01-02 10:58:34.624  INFO 5711 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-1"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:93\n2021-01-02 10:58:34.623  INFO 5711 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-3"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:90\n2021-01-02 10:58:34.625  INFO 5711 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-8"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:94\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("同样Integer也不是线程安全的方法，不能保证最终结果是100。")]),s._v(" "),n("h3",{attrs:{id:"案例4-synchronized-关键字"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例4-synchronized-关键字","aria-hidden":"true"}},[s._v("#")]),s._v(" 案例4-synchronized 关键字")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Controller")]),s._v("\n"),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"/unsafe"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("UnsafeController")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("final")]),s._v(" Logger logger "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" LoggerFactory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getLogger")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UnsafeController"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v("  "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" count "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"/index"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" String "),n("span",{attrs:{class:"token function"}},[s._v("index")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        count"),n("span",{attrs:{class:"token operator"}},[s._v("++")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Unsafe Controller count should be:"')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" count"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"unsafe"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("2021-01-02 10:49:11.664  INFO 5450 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-7"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:94\n2021-01-02 10:49:11.665  INFO 5450 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-3"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:95\n2021-01-02 10:49:11.668  INFO 5450 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-9"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:96\n2021-01-02 10:49:11.669  INFO 5450 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-4"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:97\n2021-01-02 10:49:11.669  INFO 5450 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-1"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:98\n2021-01-02 10:49:11.670  INFO 5450 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-2"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:99\n2021-01-02 10:49:11.670  INFO 5450 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-7"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:100\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"案例5-synchronized修饰代码段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例5-synchronized修饰代码段","aria-hidden":"true"}},[s._v("#")]),s._v(" 案例5-synchronized修饰代码段")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Controller")]),s._v("\n"),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"/unsafe"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("UnsafeController")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("final")]),s._v(" Logger logger "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" LoggerFactory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getLogger")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UnsafeController"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v("  Integer count "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"/index"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v("  String "),n("span",{attrs:{class:"token function"}},[s._v("index")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("synchronized")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            count"),n("span",{attrs:{class:"token operator"}},[s._v("++")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Unsafe Controller count should be:"')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" count"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"unsafe"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ab -n 1000 -c 10 http://localhost:8080/unsafe/index\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("2021-01-02 10:53:28.234  INFO 5609 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-2"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:998\n2021-01-02 10:53:28.234  INFO 5609 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-4"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:997\n2021-01-02 10:53:28.234  INFO 5609 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-1"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:997\n2021-01-02 10:53:28.234  INFO 5609 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-8"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:999\n2021-01-02 10:53:28.235  INFO 5609 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-9"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Unsafe Controller count should be:1000\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"案例6-使用atomicinteger"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例6-使用atomicinteger","aria-hidden":"true"}},[s._v("#")]),s._v(" 案例6-使用AtomicInteger")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Controller")]),s._v("\n"),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"/unsafe"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("UnsafeController")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("final")]),s._v(" Logger logger "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" LoggerFactory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getLogger")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UnsafeController"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" AtomicInteger count "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("AtomicInteger")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"/index"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" String "),n("span",{attrs:{class:"token function"}},[s._v("index")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        count"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("addAndGet")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Unsafe Controller count should be:"')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" count"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"unsafe"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("ab -n 10000 -c 50 http://localhost:8080/unsafe/index\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"使用spring托管的service-bean是否线程安全"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用spring托管的service-bean是否线程安全","aria-hidden":"true"}},[s._v("#")]),s._v(" 使用Spring托管的Service Bean是否线程安全")]),s._v(" "),n("p",[s._v("我们常说Spring托管的bean是singleton的，那么如果把逻辑放入一个bean，然后在controller引用这个bean，会解决并发，保证原子性吗？")]),s._v(" "),n("p",[s._v("答案是否定的。")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Service")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("SumBean")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" cnt "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("plus")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnt"),n("span",{attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("getCnt")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" cnt"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h3",{attrs:{id:"案例7-service-bean"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例7-service-bean","aria-hidden":"true"}},[s._v("#")]),s._v(" 案例7-Service Bean")]),s._v(" "),n("p",[s._v("我们新建一个contoller方法")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[s._v("\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"/sum"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@ResponseBody")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" String "),n("span",{attrs:{class:"token function"}},[s._v("sum")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        sum"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("plus")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Sum Bean count should be:"')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" sum"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getCnt")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"sum"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" ab -n 100 -c 10 http://localhost:8080/unsafe/sum\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("2021-01-02 11:44:09.006  INFO 6606 --- [nio-8080-exec-5] c.f.s.t.controller.UnsafeController      : Sum Bean count should be:92\n2021-01-02 11:44:09.006  INFO 6606 --- [io-8080-exec-10] c.f.s.t.controller.UnsafeController      : Sum Bean count should be:93\n2021-01-02 11:44:09.007  INFO 6606 --- [nio-8080-exec-7] c.f.s.t.controller.UnsafeController      : Sum Bean count should be:94\n2021-01-02 11:44:09.007  INFO 6606 --- [nio-8080-exec-6] c.f.s.t.controller.UnsafeController      : Sum Bean count should be:95\n2021-01-02 11:44:09.009  INFO 6606 --- [nio-8080-exec-4] c.f.s.t.controller.UnsafeController      : Sum Bean count should be:96\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("残念ですが")]),s._v(" "),n("p",[s._v("程序并没有输出我们期待的100。其实与放在controller里一样.Spring mvc是一个多线程的环境，线程之间修改共享的对象或者属性，是非常危险的。")]),s._v(" "),n("p",[s._v("Spring容器会初始化一个DispatcherServlet实例。容器同样管理着一个线程池用于响应HTTP连接。当一个请求来的时候，容器从线程池中拿出一个线程，执行service()方法，把请求转发给正确的@Controller实例。")]),s._v(" "),n("p",[s._v("所以，如果我们保证Sumbean的原子性操作")]),s._v(" "),n("h3",{attrs:{id:"案例8-synchronized"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例8-synchronized","aria-hidden":"true"}},[s._v("#")]),s._v(" 案例8-synchronized")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Service")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("SumBean")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" cnt "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v("  "),n("span",{attrs:{class:"token keyword"}},[s._v("final")]),s._v(" Logger logger "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" LoggerFactory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getLogger")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SumBean"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("plus")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnt"),n("span",{attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Sum Bean count should be:"')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" cnt"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("getCnt")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" cnt"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"案例9-atomicinteger"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例9-atomicinteger","aria-hidden":"true"}},[s._v("#")]),s._v(" 案例9-AtomicInteger")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Service")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("SumBean")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("//private int cnt = 0;")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" AtomicInteger cnt "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("AtomicInteger")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v("  "),n("span",{attrs:{class:"token keyword"}},[s._v("final")]),s._v(" Logger logger "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" LoggerFactory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getLogger")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SumBean"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v("  "),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("plus")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnt"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("incrementAndGet")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Sum Bean count should be:"')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" cnt"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("getCnt")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" cnt"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("get")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"案例10-模拟数据库访问"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例10-模拟数据库访问","aria-hidden":"true"}},[s._v("#")]),s._v(" 案例10-模拟数据库访问")]),s._v(" "),n("p",[s._v("在这个案例中，我们模拟一个数据库应用，扣减库存。")]),s._v(" "),n("ul",[n("li",[s._v("向Contoller发起请求，每次请求扣减1个库存。系统初始化为10000.")]),s._v(" "),n("li",[s._v("Service负责计算库存，并调用DAO保存。\n我们预想中使用的库存和可用库存的总数量应该为10000.")])]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("/**\n*模拟DAO\n*/")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("InventoryDAO")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{attrs:{class:"token comment"}},[s._v("//库存初始化为10000")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" Integer availableStock"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),n("span",{attrs:{class:"token number"}},[s._v("10000")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" Integer usedStock "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("0")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" Integer "),n("span",{attrs:{class:"token function"}},[s._v("getStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("availableStock"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("setStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Integer qty"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("availableStock "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" qty"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("setUsedStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Integer qty"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("usedStock "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("usedStock "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" qty"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" Integer "),n("span",{attrs:{class:"token function"}},[s._v("getUsedStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("usedStock"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Service")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("/*\n*业务逻辑\n*/")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Inventory")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    InventoryDAO inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v("  "),n("span",{attrs:{class:"token keyword"}},[s._v("final")]),s._v(" Logger logger "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" LoggerFactory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getLogger")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Inventory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[s._v("//扣减库存")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v("  "),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("allocateStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" qty"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        Integer newQty"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token operator"}},[s._v(">=")]),s._v(" qty"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            newQty "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v(" qty"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("setStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newQty"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("setUsedStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("qty"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Stock left/Stock used: "')]),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"/"')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getUsedStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Stock not Available"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("getStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("intValue")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("getUsedStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getUsedStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("intValue")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Controller")]),s._v("\n"),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"/unsafe"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("UnsafeController")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("final")]),s._v(" Logger logger "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" LoggerFactory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getLogger")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UnsafeController"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" Inventory inventory"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"inv"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@ResponseBody")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("//每次扣减1个")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v("  String "),n("span",{attrs:{class:"token function"}},[s._v("inv")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" qty "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        inventory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("allocateStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"used stock should be: "')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" inventory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getUsedStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"inv"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br")])]),n("p",[s._v("总共发起100个请求，并发为10")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ab -n 100 -c 10 http://localhost:8080/unsafe/inv\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("按照预期，最终使用的使用库存数和库存余数和应该为10000，使用库存应该为100，预存余数应该为9900")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("2021-01-02 16:01:41.466  INFO 10680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-1"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 84\n2021-01-02 16:01:41.466  INFO 10680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("io-8080-exec-10"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.sample.threadsafe.service.Inventory  "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Stock left/Stock used: 9914/86\n2021-01-02 16:01:41.466  INFO 10680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-8"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.sample.threadsafe.service.Inventory  "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Stock left/Stock used: 9915/85\n2021-01-02 16:01:41.466  INFO 10680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-5"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.sample.threadsafe.service.Inventory  "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Stock left/Stock used: 9913/87\n2021-01-02 16:01:41.466  INFO 10680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("io-8080-exec-10"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 87\n2021-01-02 16:01:41.466  INFO 10680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-8"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 87\n2021-01-02 16:01:41.466  INFO 10680 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-5"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 87\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("多次执行，我们发现，使用库存数几乎都不是100.")]),s._v(" "),n("h4",{attrs:{id:"如何保证线程安全"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何保证线程安全","aria-hidden":"true"}},[s._v("#")]),s._v(" 如何保证线程安全")]),s._v(" "),n("p",[s._v("与之前的例子一样，我们可以使用synchronized方式来改造上述代码。")]),s._v(" "),n("p",[s._v("除此以外还可以使用ReentranLock。")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Service")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Inventory")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    InventoryDAO inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v("  Lock lock"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("Inventory")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lock "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("ReentrantLock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v("  "),n("span",{attrs:{class:"token keyword"}},[s._v("final")]),s._v(" Logger logger "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" LoggerFactory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getLogger")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Inventory"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("class")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v("  "),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("allocateStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" qty"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        Integer newQty"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        lock"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("lock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v(">=")]),s._v(" qty"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                newQty "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v(" qty"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("setStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newQty"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("setUsedStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("qty"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Stock left/Stock used: "')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"/"')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getUsedStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                logger"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("info")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Stock not Available"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            lock"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("unlock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("getStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("intValue")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("getUsedStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" inventoryDAO"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getUsedStock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("intValue")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("p",[s._v("执行测试")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ab -n 100 -c 10 http://localhost:8080/unsafe/inv\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("2021-01-02 20:47:16.057  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-7"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.sample.threadsafe.service.Inventory  "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Stock left/Stock used: 9903/97\n2021-01-02 20:47:16.057  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-7"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 97\n2021-01-02 20:47:16.057  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-8"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.sample.threadsafe.service.Inventory  "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Stock left/Stock used: 9902/98\n2021-01-02 20:47:16.057  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-8"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 98\n2021-01-02 20:47:16.059  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-9"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.sample.threadsafe.service.Inventory  "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Stock left/Stock used: 9901/99\n2021-01-02 20:47:16.059  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-9"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 99\n2021-01-02 20:47:16.059  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("io-8080-exec-10"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.sample.threadsafe.service.Inventory  "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Stock left/Stock used: 9900/100\n2021-01-02 20:47:16.059  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("io-8080-exec-10"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 100\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n 2021-01-02 20:47:24.693  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-5"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 197\n2021-01-02 20:47:24.695  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("io-8080-exec-10"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.sample.threadsafe.service.Inventory  "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Stock left/Stock used: 9802/198\n2021-01-02 20:47:24.695  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("io-8080-exec-10"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 198\n2021-01-02 20:47:24.695  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-7"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.sample.threadsafe.service.Inventory  "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Stock left/Stock used: 9801/199\n2021-01-02 20:47:24.695  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-7"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 199\n2021-01-02 20:47:24.697  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-1"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.sample.threadsafe.service.Inventory  "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Stock left/Stock used: 9800/200\n2021-01-02 20:47:24.697  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-1"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 200\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n2021-01-02 20:47:29.751  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-1"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.sample.threadsafe.service.Inventory  "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Stock left/Stock used: 9702/298\n2021-01-02 20:47:29.751  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-1"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 298\n2021-01-02 20:47:29.751  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("io-8080-exec-10"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.sample.threadsafe.service.Inventory  "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Stock left/Stock used: 9701/299\n2021-01-02 20:47:29.751  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("io-8080-exec-10"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 299\n2021-01-02 20:47:29.753  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-9"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.sample.threadsafe.service.Inventory  "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" Stock left/Stock used: 9700/300\n2021-01-02 20:47:29.753  INFO 13090 --- "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nio-8080-exec-9"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" c.f.s.t.controller.UnsafeController      "),n("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" used stock should be: 300\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("method")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    method body\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("与下面这段代码等价。")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("method")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("intrinsicLock"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("lock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        method body\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n        "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("intrinsicLock"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("unlock")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("另外一般情况下（例如单体应用，一个JVM），考虑Core Java一书给出的建议")]),s._v(" "),n("ul",[n("li",[s._v("It is best to use neither Lock/Condition nor the synchronized\nkeyword. In many situations, you can use one of the mechanisms of the\njava.util.concurrent package that do all the locking for you.\nFor example, in Section 12.5.1, “Blocking Queues,” on p. 781, you will\nsee how to use a blocking queue to synchronize threads that work on a\ncommon task. You should also explore parallel streams—see Chapter 1\nof Volume II.")]),s._v(" "),n("li",[s._v("If the synchronized keyword works for your situation, by all means,\nuse it. You’ll write less code and have less room for error. Listing 12.5\nshows the bank example, implemented with synchronized methods.")]),s._v(" "),n("li",[s._v("Use Lock/Condition if you really need the additional power that\nthese constructs give you.")])]),s._v(" "),n("h2",{attrs:{id:"多jvm-集群环境-分布式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多jvm-集群环境-分布式","aria-hidden":"true"}},[s._v("#")]),s._v(" 多JVM/集群环境/分布式")]),s._v(" "),n("p",[s._v("synchronized也好或者AtomicInteger也好，只能保证在同一个JVM中的线程安全。")]),s._v(" "),n("p",[s._v("如果在分布式环境下，要读取操作同样一份数据，就要更妥善的考虑。")])])}],!1,null,null,null);e.options.__file="singleton-scope.md";t.default=e.exports}}]);