<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Camel 单元测试 | 油腻中年大叔</title>
    <meta name="description" content="你想要的这里都没有，你不想要的这里都有">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    
    <link rel="preload" href="/assets/css/styles.ded2f491.css" as="style"><link rel="preload" href="/assets/js/app.ded2f491.js" as="script"><link rel="preload" href="/assets/js/61.cabe5660.js" as="script"><link rel="prefetch" href="/assets/js/0.eb7108e7.js"><link rel="prefetch" href="/assets/js/1.d8ec4d72.js"><link rel="prefetch" href="/assets/js/2.28f90b8d.js"><link rel="prefetch" href="/assets/js/3.6001361f.js"><link rel="prefetch" href="/assets/js/4.80c27a58.js"><link rel="prefetch" href="/assets/js/5.2e2f809b.js"><link rel="prefetch" href="/assets/js/6.0d0d8441.js"><link rel="prefetch" href="/assets/js/7.8e4037c3.js"><link rel="prefetch" href="/assets/js/8.5752a787.js"><link rel="prefetch" href="/assets/js/9.8329deb8.js"><link rel="prefetch" href="/assets/js/10.4843c5ba.js"><link rel="prefetch" href="/assets/js/11.9e8b7549.js"><link rel="prefetch" href="/assets/js/12.02c0fa30.js"><link rel="prefetch" href="/assets/js/13.f5d738e8.js"><link rel="prefetch" href="/assets/js/14.24f8e576.js"><link rel="prefetch" href="/assets/js/15.e752518b.js"><link rel="prefetch" href="/assets/js/16.d74da356.js"><link rel="prefetch" href="/assets/js/17.5759e4d8.js"><link rel="prefetch" href="/assets/js/18.4e466a14.js"><link rel="prefetch" href="/assets/js/19.60a2d73f.js"><link rel="prefetch" href="/assets/js/20.c9a0e62d.js"><link rel="prefetch" href="/assets/js/21.40026d70.js"><link rel="prefetch" href="/assets/js/22.c5b0ef8a.js"><link rel="prefetch" href="/assets/js/23.6f254965.js"><link rel="prefetch" href="/assets/js/24.fcf66f98.js"><link rel="prefetch" href="/assets/js/25.76bed4da.js"><link rel="prefetch" href="/assets/js/26.a29ecb98.js"><link rel="prefetch" href="/assets/js/27.19c14279.js"><link rel="prefetch" href="/assets/js/28.da0a820a.js"><link rel="prefetch" href="/assets/js/29.ac0b92bb.js"><link rel="prefetch" href="/assets/js/30.2f36adb4.js"><link rel="prefetch" href="/assets/js/31.3b64636b.js"><link rel="prefetch" href="/assets/js/32.ab10440c.js"><link rel="prefetch" href="/assets/js/33.68e3f3f0.js"><link rel="prefetch" href="/assets/js/34.3996b8a2.js"><link rel="prefetch" href="/assets/js/35.6b7df171.js"><link rel="prefetch" href="/assets/js/36.01c663d5.js"><link rel="prefetch" href="/assets/js/37.24b862f7.js"><link rel="prefetch" href="/assets/js/38.27c698de.js"><link rel="prefetch" href="/assets/js/39.39eda98a.js"><link rel="prefetch" href="/assets/js/40.0d3a27e1.js"><link rel="prefetch" href="/assets/js/41.36133d84.js"><link rel="prefetch" href="/assets/js/42.4f708108.js"><link rel="prefetch" href="/assets/js/43.286ed069.js"><link rel="prefetch" href="/assets/js/44.69931ba8.js"><link rel="prefetch" href="/assets/js/45.9b6a53af.js"><link rel="prefetch" href="/assets/js/46.44e01f27.js"><link rel="prefetch" href="/assets/js/47.86ea0068.js"><link rel="prefetch" href="/assets/js/48.6d6e8398.js"><link rel="prefetch" href="/assets/js/49.eb3a0c16.js"><link rel="prefetch" href="/assets/js/50.5b9dbd38.js"><link rel="prefetch" href="/assets/js/51.e16cec94.js"><link rel="prefetch" href="/assets/js/52.08a38998.js"><link rel="prefetch" href="/assets/js/53.eab809f5.js"><link rel="prefetch" href="/assets/js/54.d13dbba6.js"><link rel="prefetch" href="/assets/js/55.6808ce92.js"><link rel="prefetch" href="/assets/js/56.096d270b.js"><link rel="prefetch" href="/assets/js/57.e4249cdf.js"><link rel="prefetch" href="/assets/js/58.c8669079.js"><link rel="prefetch" href="/assets/js/59.ad4f9d5d.js"><link rel="prefetch" href="/assets/js/60.1fb42366.js"><link rel="prefetch" href="/assets/js/62.fa1a1298.js"><link rel="prefetch" href="/assets/js/63.45ab79de.js"><link rel="prefetch" href="/assets/js/64.1b1f9f0e.js"><link rel="prefetch" href="/assets/js/65.8ec5686f.js"><link rel="prefetch" href="/assets/js/66.c678baef.js"><link rel="prefetch" href="/assets/js/67.19e5c964.js"><link rel="prefetch" href="/assets/js/68.1ed9f179.js"><link rel="prefetch" href="/assets/js/69.c24b07f2.js"><link rel="prefetch" href="/assets/js/70.0d51bff2.js"><link rel="prefetch" href="/assets/js/71.c4b4b293.js"><link rel="prefetch" href="/assets/js/72.14906a78.js"><link rel="prefetch" href="/assets/js/73.63ff0ad9.js"><link rel="prefetch" href="/assets/js/74.b9adca9b.js"><link rel="prefetch" href="/assets/js/75.545e5298.js"><link rel="prefetch" href="/assets/js/76.a0b47a49.js"><link rel="prefetch" href="/assets/js/77.7e27edab.js"><link rel="prefetch" href="/assets/js/78.1142e5fa.js"><link rel="prefetch" href="/assets/js/79.7c5cfce2.js"><link rel="prefetch" href="/assets/js/80.fc2c556d.js"><link rel="prefetch" href="/assets/js/81.8879b553.js"><link rel="prefetch" href="/assets/js/82.eacf1768.js"><link rel="prefetch" href="/assets/js/83.e45b0c21.js"><link rel="prefetch" href="/assets/js/84.1a4d1083.js"><link rel="prefetch" href="/assets/js/85.03758b26.js"><link rel="prefetch" href="/assets/js/86.ee483071.js"><link rel="prefetch" href="/assets/js/87.7b7f9f7e.js"><link rel="prefetch" href="/assets/js/88.ac9c1638.js"><link rel="prefetch" href="/assets/js/89.eb052447.js"><link rel="prefetch" href="/assets/js/90.422140a0.js"><link rel="prefetch" href="/assets/js/91.1590a6f8.js"><link rel="prefetch" href="/assets/js/92.96889e30.js"><link rel="prefetch" href="/assets/js/93.781dc372.js"><link rel="prefetch" href="/assets/js/94.67dfc4fd.js"><link rel="prefetch" href="/assets/js/95.2ec84126.js"><link rel="prefetch" href="/assets/js/96.9c8d4164.js"><link rel="prefetch" href="/assets/js/97.8e9b31ed.js"><link rel="prefetch" href="/assets/js/98.9842e1fc.js"><link rel="prefetch" href="/assets/js/99.393bed11.js"><link rel="prefetch" href="/assets/js/100.cce59a63.js"><link rel="prefetch" href="/assets/js/101.a716746b.js"><link rel="prefetch" href="/assets/js/102.8c93513c.js"><link rel="prefetch" href="/assets/js/103.d3a45484.js"><link rel="prefetch" href="/assets/js/104.ce471cd5.js"><link rel="prefetch" href="/assets/js/105.333da2a2.js"><link rel="prefetch" href="/assets/css/106.styles.2ca1612a.css"><link rel="prefetch" href="/assets/js/106.2ca1612a.js"><link rel="prefetch" href="/assets/css/107.styles.da40c964.css"><link rel="prefetch" href="/assets/js/107.da40c964.js">
    <link rel="stylesheet" href="/assets/css/106.styles.2ca1612a.css"><link rel="stylesheet" href="/assets/css/107.styles.da40c964.css"><link rel="stylesheet" href="/assets/css/styles.ded2f491.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">油腻中年大叔</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dart/" class="nav-link">Dart</a></div><div class="nav-item"><a href="/spring/" class="nav-link">spring</a></div><div class="nav-item"><a href="/drools/" class="nav-link">规则和业务流程</a></div><div class="nav-item"><a href="/eip/" class="nav-link router-link-active">EIP集成工具</a></div><div class="nav-item"><a href="/other/" class="nav-link">杂项</a></div><div class="nav-item"><a href="/algorithms/" class="nav-link">算法</a></div><div class="nav-item"><a href="/riding/" class="nav-link">骑行</a></div><div class="nav-item"><a href="/ev3/" class="nav-link">LEGO EV3 </a></div><div class="nav-item"><a href="/mb/" class="nav-link">Micro:bit </a></div><div class="nav-item"><a href="/math/" class="nav-link">小学数学 </a></div><div class="nav-item"><a href="/eng/" class="nav-link">小学英语 </a></div><div class="nav-item"><a href="/jp/" class="nav-link">日语 </a></div><div class="nav-item"><a href="/gs1/" class="nav-link">GS-1</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dart/" class="nav-link">Dart</a></div><div class="nav-item"><a href="/spring/" class="nav-link">spring</a></div><div class="nav-item"><a href="/drools/" class="nav-link">规则和业务流程</a></div><div class="nav-item"><a href="/eip/" class="nav-link router-link-active">EIP集成工具</a></div><div class="nav-item"><a href="/other/" class="nav-link">杂项</a></div><div class="nav-item"><a href="/algorithms/" class="nav-link">算法</a></div><div class="nav-item"><a href="/riding/" class="nav-link">骑行</a></div><div class="nav-item"><a href="/ev3/" class="nav-link">LEGO EV3 </a></div><div class="nav-item"><a href="/mb/" class="nav-link">Micro:bit </a></div><div class="nav-item"><a href="/math/" class="nav-link">小学数学 </a></div><div class="nav-item"><a href="/eng/" class="nav-link">小学英语 </a></div><div class="nav-item"><a href="/jp/" class="nav-link">日语 </a></div><div class="nav-item"><a href="/gs1/" class="nav-link">GS-1</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/eip/camelcheatsheet.html" class="sidebar-link">Camel Cheat Sheet</a></li><li><a href="/eip/camel-split.html" class="sidebar-link">Camel分解消息</a></li><li><a href="/eip/camel-content-router.html" class="sidebar-link">Camel内容路由</a></li><li><a href="/eip/camel-component-custom.html" class="sidebar-link">自定义Camel组件</a></li><li><a href="/eip/camel-test.html" class="active sidebar-link">Camel测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/eip/camel-test.html#camel-单元测试" class="sidebar-link">Camel 单元测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/eip/camel-test.html#例1：移动文件" class="sidebar-link">例1：移动文件</a></li><li class="sidebar-sub-header"><a href="/eip/camel-test.html#例2：direct路由" class="sidebar-link">例2：direct路由</a></li><li class="sidebar-sub-header"><a href="/eip/camel-test.html#例3：模拟路由" class="sidebar-link">例3：模拟路由</a></li><li class="sidebar-sub-header"><a href="/eip/camel-test.html#例4：spring-xml-dsl的路由测试" class="sidebar-link">例4：Spring XML DSL的路由测试</a></li><li class="sidebar-sub-header"><a href="/eip/camel-test.html#例5：springboot-camel测试-xml-import方式集成camel" class="sidebar-link">例5：SpringBoot Camel测试---XML import方式集成Camel</a></li><li class="sidebar-sub-header"><a href="/eip/camel-test.html#例5：springboot-camel测试-routebuilder" class="sidebar-link">例5：SpringBoot Camel测试-RouteBuilder</a></li><li class="sidebar-sub-header"><a href="/eip/camel-test.html#例6：springboot-camel测试-routebuilder-2" class="sidebar-link">例6：SpringBoot Camel测试-RouteBuilder-2</a></li></ul></li></ul></li><li><a href="/eip/camel-seda-direct-vm.html" class="sidebar-link">Camel SEDA Direct VM组件</a></li><li><a href="/eip/loop-in-pentaho.html" class="sidebar-link">在pentaho中使用循环</a></li></ul> </div> <div class="page"> <div class="content"><h2 id="camel-单元测试"><a href="#camel-单元测试" aria-hidden="true" class="header-anchor">#</a> Camel 单元测试</h2> <h3 id="例1：移动文件"><a href="#例1：移动文件" aria-hidden="true" class="header-anchor">#</a> 例1：移动文件</h3> <h4 id="路由设计"><a href="#路由设计" aria-hidden="true" class="header-anchor">#</a> 路由设计</h4> <p>从一个文件夹移动文件到另外一个文件夹</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>learncamel<span class="token punctuation">.</span>file<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>builder<span class="token punctuation">.</span>RouteBuilder<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CopyFilesRoute</span> <span class="token keyword">extends</span> <span class="token class-name">RouteBuilder</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">{</span>
        <span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;file:data/input?noop=true&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">&quot;file:data/output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="测试用例"><a href="#测试用例" aria-hidden="true" class="header-anchor">#</a> 测试用例</h4> <p>在下面的示例中，CopyFileRouteTest类将继承CamelTestSupport并覆盖createRouteBuilder方法。 此方法将创建上面定义的路径CopyFilesRoute。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">package</span> com<span class="token punctuation">.</span>learncamel<span class="token punctuation">.</span>file<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>RoutesBuilder<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>test<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>CamelTestSupport<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CopyFileRouteTest</span> <span class="token keyword">extends</span> <span class="token class-name">CamelTestSupport</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> RoutesBuilder <span class="token function">createRouteBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CopyFilesRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkFileExistsInOutputDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException
    <span class="token punctuation">{</span>
        Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        File file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;data/output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertTrue</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>file<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>上面的代码定义了方法checkFileExistsInOutputDirectory（），这个测试用例将检查输出目录是否存在以及移动到输出目录的文件数是2。</p> <h3 id="例2：direct路由"><a href="#例2：direct路由" aria-hidden="true" class="header-anchor">#</a> 例2：direct路由</h3> <h4 id="路由设计-2"><a href="#路由设计-2" aria-hidden="true" class="header-anchor">#</a> 路由设计</h4> <p>在这里，我们将开发一个带有direct组件的简单路由。direct组件在生产者发送消息交换时提供任一消费者的直接，同步调用。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>learncamel<span class="token punctuation">.</span>direct<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>builder<span class="token punctuation">.</span>RouteBuilder<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleDirectRoute</span> <span class="token keyword">extends</span> <span class="token class-name">RouteBuilder</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception
    <span class="token punctuation">{</span>
        <span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;direct:sampleInput&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received Message is ${body} and Headers are ${headers}&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">&quot;file:sampleOutput?fileName=output.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="测试用例-2"><a href="#测试用例-2" aria-hidden="true" class="header-anchor">#</a> 测试用例</h4> <p>测试用例将检查文件是否是目录，它将验证文件名。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>learncamel<span class="token punctuation">.</span>direct<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>Exchange<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>Route<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>builder<span class="token punctuation">.</span>RouteBuilder<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>test<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>CamelTestSupport<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleDirectRouteTest</span> <span class="token keyword">extends</span> <span class="token class-name">CamelTestSupport</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> RouteBuilder <span class="token function">createRouteBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SampleDirectRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">SampleTestRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException<span class="token punctuation">{</span>
	     <span class="token comment">//设置消息，template是测试类内置的Producer</span>
        template<span class="token punctuation">.</span><span class="token function">sendBody</span><span class="token punctuation">(</span><span class="token string">&quot;direct:sampleInput&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        File file<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;sampleOutput&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertTrue</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Exchange exchange <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token string">&quot;file:sampleOutput&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Received body is :&quot;</span> <span class="token operator">+</span> exchange<span class="token punctuation">.</span><span class="token function">getIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;File Name is :&quot;</span> <span class="token operator">+</span> exchange<span class="token punctuation">.</span><span class="token function">getIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;CamelFileName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;output.txt&quot;</span><span class="token punctuation">,</span> exchange<span class="token punctuation">.</span><span class="token function">getIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;CamelFileName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="例3：模拟路由"><a href="#例3：模拟路由" aria-hidden="true" class="header-anchor">#</a> 例3：模拟路由</h3> <h4 id="路由设计-3"><a href="#路由设计-3" aria-hidden="true" class="header-anchor">#</a> 路由设计</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">package</span> com<span class="token punctuation">.</span>learncamel<span class="token punctuation">.</span>direct<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>builder<span class="token punctuation">.</span>RouteBuilder<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleMockRoute</span> <span class="token keyword">extends</span> <span class="token class-name">RouteBuilder</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;direct:sampleInput&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received Message is ${body} and Headers are ${headers}&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">&quot;mock:output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="测试用例-3"><a href="#测试用例-3" aria-hidden="true" class="header-anchor">#</a> 测试用例</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>learncamel<span class="token punctuation">.</span>direct<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>test<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>CamelTestSupport<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>Exchange<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>RoutesBuilder<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>component<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>MockEndpoint<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>test<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>CamelTestSupport<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleMockRouteTest</span> <span class="token keyword">extends</span> <span class="token class-name">CamelTestSupport</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> RoutesBuilder <span class="token function">createRouteBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SampleMockRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sampleMockTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
        String expected<span class="token operator">=</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">/**
         * Producer Template.
         */</span>
		 <span class="token comment">//获取endpoint</span>
        MockEndpoint mock <span class="token operator">=</span> <span class="token function">getMockEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;mock:output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//expected方法</span>
        mock<span class="token punctuation">.</span><span class="token function">expectedBodiesReceived</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String input<span class="token operator">=</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">//使用producer创建消息</span>
        template<span class="token punctuation">.</span><span class="token function">sendBody</span><span class="token punctuation">(</span><span class="token string">&quot;direct:sampleInput&quot;</span><span class="token punctuation">,</span>input <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//断言</span>
        <span class="token function">assertMockEndpointsSatisfied</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>更多关于MockEndpoint的内容：
http://people.apache.org/~dkulp/camel/testing.html
http://camel.apache.org/mock.html</p> <h3 id="例4：spring-xml-dsl的路由测试"><a href="#例4：spring-xml-dsl的路由测试" aria-hidden="true" class="header-anchor">#</a> 例4：Spring XML DSL的路由测试</h3> <h4 id="路由设计-4"><a href="#路由设计-4" aria-hidden="true" class="header-anchor">#</a> 路由设计</h4> <p>把json数据中的email提取分解</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>camel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://camel.apache.org/schema/spring<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>camelContext</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jsonsplit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>route</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>from</span> <span class="token attr-name">uri</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>direct:start<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>split</span> <span class="token attr-name">streaming</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>jsonpath</span><span class="token punctuation">&gt;</span></span>$.[*].email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">camel:</span>jsonpath</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>log</span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${body}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">camel:</span>log</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>to</span> <span class="token attr-name">uri</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mock:result<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">camel:</span>to</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">camel:</span>split</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">camel:</span>route</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">camel:</span>camelContext</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="测试用例-4"><a href="#测试用例-4" aria-hidden="true" class="header-anchor">#</a> 测试用例</h4> <p>ProducerTemplate和MockEndpoint采用注解的方式注入，不用继承CamelTestSupport。
使用@RunWith(SpringJUnit4ClassRunner.class)声明为Spring测试用例</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DirtiesContext</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CamelSplitTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@EndpointInject</span><span class="token punctuation">(</span>uri <span class="token operator">=</span> <span class="token string">&quot;mock:result&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> MockEndpoint mock<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Produce</span><span class="token punctuation">(</span>uri <span class="token operator">=</span> <span class="token string">&quot;direct:start&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> ProducerTemplate template<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSplit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        mock<span class="token punctuation">.</span><span class="token function">expectedBodiesReceived</span><span class="token punctuation">(</span><span class="token string">&quot;ram@gmail.com&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;shyam23@gmail.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mock<span class="token punctuation">.</span><span class="token function">expectedMinimumMessageCount</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String msg <span class="token operator">=</span> <span class="token string">&quot;[  {\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \&quot;name\&quot;: \&quot;Ram\&quot;,\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \&quot;email\&quot;: \&quot;ram@gmail.com\&quot;,\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \&quot;age\&quot;: 23,\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \&quot;hobby\&quot;:[\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;      \&quot;writing\&quot;,\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;      \&quot;riding\&quot;,\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;      \&quot;drawing\&quot;\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    ]\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;  },\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;  {\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \&quot;name\&quot;: \&quot;Shyam\&quot;,\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \&quot;email\&quot;: \&quot;shyam23@gmail.com\&quot;,\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \&quot;age\&quot;: 28\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;  }]&quot;</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">sendBody</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mock<span class="token punctuation">.</span><span class="token function">assertIsSatisfied</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>更多关于CamelSpring测试的内容：http://camel.apache.org/spring-testing.html</p> <h3 id="例5：springboot-camel测试-xml-import方式集成camel"><a href="#例5：springboot-camel测试-xml-import方式集成camel" aria-hidden="true" class="header-anchor">#</a> 例5：SpringBoot Camel测试---XML import方式集成Camel</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@ImportResource</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;classpath:camel-context.xml&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CamelSplitJsonApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>CamelSplitJsonApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="路由设计-5"><a href="#路由设计-5" aria-hidden="true" class="header-anchor">#</a> 路由设计</h4> <p>CamelSplitJsonApplicationTests-context.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>camelContext</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jsonAggregate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>route</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>from</span> <span class="token attr-name">uri</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>direct:start<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>split</span> <span class="token attr-name">streaming</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>jsonpath</span><span class="token punctuation">&gt;</span></span>$.[*].email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">camel:</span>jsonpath</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>log</span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${body}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">camel:</span>log</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">camel:</span>to</span> <span class="token attr-name">uri</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mock:result<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">camel:</span>to</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">camel:</span>split</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">camel:</span>route</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">camel:</span>camelContext</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="测试用例-5"><a href="#测试用例-5" aria-hidden="true" class="header-anchor">#</a> 测试用例</h4> <p>CamelSplitJsonApplicationTests</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CamelSplitJsonApplicationTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Produce</span><span class="token punctuation">(</span>uri<span class="token operator">=</span><span class="token string">&quot;direct:start&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> ProducerTemplate template<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@EndpointInject</span><span class="token punctuation">(</span>uri<span class="token operator">=</span><span class="token string">&quot;mock:result&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span>  MockEndpoint mockEndpoint<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSplit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
        mockEndpoint<span class="token punctuation">.</span><span class="token function">expectedBodiesReceived</span><span class="token punctuation">(</span><span class="token string">&quot;ram@gmail.com&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;shyam23@gmail.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mockEndpoint<span class="token punctuation">.</span><span class="token function">expectedMessageCount</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String msg <span class="token operator">=</span> <span class="token string">&quot;[ {\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;name\&quot;: \&quot;Ram\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;email\&quot;: \&quot;ram@gmail.com\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;age\&quot;: 23,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;hobby\&quot;:[\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;writing\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;riding\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;      \&quot;drawing\&quot;\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    ]\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;  },\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;  {\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;name\&quot;: \&quot;Shyam\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;email\&quot;: \&quot;shyam23@gmail.com\&quot;,\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;    \&quot;age\&quot;: 28\n&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;  },]&quot;</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">sendBody</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mockEndpoint<span class="token punctuation">.</span><span class="token function">assertIsSatisfied</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="例5：springboot-camel测试-routebuilder"><a href="#例5：springboot-camel测试-routebuilder" aria-hidden="true" class="header-anchor">#</a> 例5：SpringBoot Camel测试-RouteBuilder</h3> <h4 id="路由设计-6"><a href="#路由设计-6" aria-hidden="true" class="header-anchor">#</a> 路由设计</h4> <p>在路由类上使用component注解，Spring boot会自动配置，创建实例注入CamelContext</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCamelRouter</span> <span class="token keyword">extends</span> <span class="token class-name">RouteBuilder</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;timer:hello?period={{timer.period}}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">routeId</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">routeGroup</span><span class="token punctuation">(</span><span class="token string">&quot;hello-group&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">&quot;myBean&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;saySomething&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">simple</span><span class="token punctuation">(</span><span class="token string">&quot;${body} contains 'foo'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">&quot;log:foo&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">&quot;stream:out&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="测试用例-6"><a href="#测试用例-6" aria-hidden="true" class="header-anchor">#</a> 测试用例</h4> <ul><li>CamelSpringBootRunner:将CamelSpringTestSupport的功能引入基于Spring Boot Test的测试用例的实现。 这种方法允许开发人员使用典型的测试开发Spring测试约定来实现基于Spring Boot的应用程序/路由的测试。</li> <li>EnableRouteCoverage:启用保存路由测试覆盖统计，路由覆盖统计保存在target/camel-route-coverage目录。</li> <li>MockEndpoints: 模拟端点</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>@RunWith(CamelSpringBootRunner.class)
@SpringBootTest(classes = CamelSplitJsonApplication.class,
    properties = &quot;greeting = Hello foo&quot;)
@EnableRouteCoverage
@MockEndpoints(&quot;log:foo&quot;) // mock the log:foo endpoint =&gt; mock:log:foo which we then use in the testing
//@Ignore // enable me to run this test as well so we can cover testing the route completely
public class FooApplicationTest {

    @Autowired
    private CamelContext camelContext;

    @EndpointInject(uri = &quot;mock:log:foo&quot;)
    private MockEndpoint mock;

    @Test
    public void shouldSayFoo() throws Exception {
        mock.expectedBodiesReceived(&quot;Hello foo&quot;);

        // we expect that one or more messages is automatic done by the Camel
        // route as it uses a timer to trigger
        NotifyBuilder notify = new NotifyBuilder(camelContext).whenDone(1).create();

        assertTrue(notify.matches(10, TimeUnit.SECONDS));

        mock.assertIsSatisfied();
    }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="例6：springboot-camel测试-routebuilder-2"><a href="#例6：springboot-camel测试-routebuilder-2" aria-hidden="true" class="header-anchor">#</a> 例6：SpringBoot Camel测试-RouteBuilder-2</h3> <h4 id="路由设计-7"><a href="#路由设计-7" aria-hidden="true" class="header-anchor">#</a> 路由设计</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnimalRoute</span> <span class="token keyword">extends</span> <span class="token class-name">RouteBuilder</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String CAMEL_FILE_NAME <span class="token operator">=</span> <span class="token string">&quot;CamelFileName&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>

        <span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;{{animalSource}}&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;got message&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">choice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>p <span class="token operator">-</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span><span class="token function">getIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>CAMEL_FILE_NAME<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;dog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;found a dog!&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">&quot;{{dogEndpoint}}&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>p <span class="token operator">-</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span><span class="token function">getIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>CAMEL_FILE_NAME<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;cat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;looks like a cat!&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">&quot;{{catEndpoint}}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="application-properties"><a href="#application-properties" aria-hidden="true" class="header-anchor">#</a> application.properties</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>animalSource=file://animals
dogEndpoint=file://dogs
catEndpoint=file://cats

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="application-test-properties"><a href="#application-test-properties" aria-hidden="true" class="header-anchor">#</a> application-test.properties</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>animalSource=direct:animalSource
dogEndpoint=mock:dogEndpoint
catEndpoint=mock:catEndpoint
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="测试用例-7"><a href="#测试用例-7" aria-hidden="true" class="header-anchor">#</a> 测试用例</h4> <p>测试用例开发方法：</p> <ul><li>create the context,</li> <li>load the correct properties for testing,</li> <li>inject messages into the route and</li> <li>verify the result messages.</li> <li>@DirtiesContext annotation ensures that we always get a fresh Camel context for each test.</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> junit<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>TestCase<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>EndpointInject<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>ProducerTemplate<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>component<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>MockEndpoint<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>camel<span class="token punctuation">.</span>test<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>CamelSpringBootRunner<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span>RunWith<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>SpringBootTest<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>ComponentScan<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>DirtiesContext<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>ActiveProfiles<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>CamelSpringBootRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> AnimalRouteTest<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ActiveProfiles</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ComponentScan</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnimalRouteTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String NICE_DOG <span class="token operator">=</span> <span class="token string">&quot;nice dog&quot;</span><span class="token punctuation">,</span> NASTY_CAT<span class="token operator">=</span><span class="token string">&quot;nasty cat&quot;</span><span class="token punctuation">,</span> SUPERNASTY_CAT<span class="token operator">=</span><span class="token string">&quot;super nasty cat&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@EndpointInject</span><span class="token punctuation">(</span>uri <span class="token operator">=</span> <span class="token string">&quot;{{dogEndpoint}}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">protected</span> MockEndpoint dogEndpoint<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@EndpointInject</span><span class="token punctuation">(</span>uri <span class="token operator">=</span> <span class="token string">&quot;{{catEndpoint}}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">protected</span> MockEndpoint catEndpoint<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@EndpointInject</span><span class="token punctuation">(</span>uri <span class="token operator">=</span> <span class="token string">&quot;{{animalSource}}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">protected</span> ProducerTemplate animalSource<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@DirtiesContext</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>

        animalSource<span class="token punctuation">.</span><span class="token function">sendBodyAndHeader</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> AnimalRoute<span class="token punctuation">.</span>CAMEL_FILE_NAME<span class="token punctuation">,</span> NICE_DOG<span class="token punctuation">)</span><span class="token punctuation">;</span>


        dogEndpoint<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">predicate</span><span class="token punctuation">(</span>m <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            String header <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">getIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>AnimalRoute<span class="token punctuation">.</span>CAMEL_FILE_NAME<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> NICE_DOG<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dogEndpoint<span class="token punctuation">.</span><span class="token function">expectedMessageCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dogEndpoint<span class="token punctuation">.</span><span class="token function">assertIsSatisfied</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        catEndpoint<span class="token punctuation">.</span><span class="token function">expectedMessageCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        catEndpoint<span class="token punctuation">.</span><span class="token function">assertIsSatisfied</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@DirtiesContext</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>


        animalSource<span class="token punctuation">.</span><span class="token function">sendBodyAndHeader</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> AnimalRoute<span class="token punctuation">.</span>CAMEL_FILE_NAME<span class="token punctuation">,</span> NASTY_CAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        animalSource<span class="token punctuation">.</span><span class="token function">sendBodyAndHeader</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> AnimalRoute<span class="token punctuation">.</span>CAMEL_FILE_NAME<span class="token punctuation">,</span> SUPERNASTY_CAT<span class="token punctuation">)</span><span class="token punctuation">;</span>


        catEndpoint<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">predicate</span><span class="token punctuation">(</span>m <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            String header <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">getIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>AnimalRoute<span class="token punctuation">.</span>CAMEL_FILE_NAME<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> NASTY_CAT<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        catEndpoint<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">predicate</span><span class="token punctuation">(</span>m <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            String header <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">getIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>AnimalRoute<span class="token punctuation">.</span>CAMEL_FILE_NAME<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> SUPERNASTY_CAT<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        catEndpoint<span class="token punctuation">.</span><span class="token function">expectedMessageCount</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        dogEndpoint<span class="token punctuation">.</span><span class="token function">expectedMessageCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        dogEndpoint<span class="token punctuation">.</span><span class="token function">assertIsSatisfied</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        catEndpoint<span class="token punctuation">.</span><span class="token function">assertIsSatisfied</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><p>更多内容阅读：</p> <ul><li>http://camel.apache.org/spring-boot.html</li> <li>https://stackoverflow.com/questions/47796388/spring-boot-and-camel-testing-with-springboottest</li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/eip/camel-component-custom.html" class="prev">
          自定义Camel组件
        </a></span> <span class="next"><a href="/eip/camel-seda-direct-vm.html">
          Camel SEDA Direct VM组件
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/61.cabe5660.js" defer></script><script src="/assets/js/app.ded2f491.js" defer></script>
  </body>
</html>
